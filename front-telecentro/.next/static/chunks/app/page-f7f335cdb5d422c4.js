(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6951:(e,t,r)=>{Promise.resolve().then(r.bind(r,1593))},1593:(e,t,r)=>{"use strict";r.d(t,{default:()=>W});var a=r(5155);let s={BACKEND:r(2818).env.BACKEND||"server-telecentro-224237244779.us-central1.run.app:443",SYSTEMPROMPT:"\n   ## System Prompt: Asistencia Tecnica Telecentro\n\nSos Juan, un asistente para los ingenieros que realizan instalaciones en la calle de equipamiento para conectividad de internet en la empresa Telecentro.\n\nTu objetivo es simplificar la actividad en campo para registrar la instalaci\xf3n entonces\ntenes que ayudar al tecnico en la identificacion de la informacion de los equipos.\nPara eso, el tecnico tiene que mostrarte con el video el equipo a registrar.\nPor cada equipo tenes que identificar cuantas etiquetas amarillas tiene y por cada etiqueta amarilla tenes que identificar el texto que tiene.\nSi no podes identificarlo porque no esta clara la imagen, tenes que guiar al ingeniero a que enfoque bien con la camara.\n\nS\xe9 siempre amable, emp\xe1tico, claro y conciso. Siempre habla en espa\xf1ol.\nCualquier consulta que te hagan que no tenga que ver con tu tarea contesta que no estas capacitado para responderla.\n    "};var n=r(2115),i=r(6164),l=r(4216);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter(Boolean).join(" ")}let c=n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:o("rounded-xl border bg-card text-card-foreground shadow",r),...s})});c.displayName="Card",n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:o("flex flex-col space-y-1.5 p-6",r),...s})}).displayName="CardHeader",n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:o("font-semibold leading-none tracking-tight",r),...s})}).displayName="CardTitle",n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:o("text-sm text-muted-foreground",r),...s})}).displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:o("p-6 pt-0",r),...s})});d.displayName="CardContent",n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:o("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter";var u=r(2317),m=r(6421);let f=(0,m.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",blue:"bg-blue-600 text-primary-foreground shadow hover:bg-blue-600/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),p=n.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:i=!1,...l}=e,c=i?u.DX:"button";return(0,a.jsx)(c,{className:o(f({variant:s,size:n,className:r})),ref:t,...l})});p.displayName="Button";let x=(0,m.F)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),h=n.forwardRef((e,t)=>{let{className:r,variant:s,...n}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:o(x({variant:s}),r),...n})});h.displayName="Alert";let g=n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h5",{ref:t,className:o("mb-1 font-medium leading-none tracking-tight",r),...s})});g.displayName="AlertTitle";let v=n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:o("text-sm [&_p]:leading-relaxed",r),...s})});v.displayName="AlertDescription";var b=r(8319),y=r(1719),N=r(8867);let j=b.bL;b.YJ;let w=b.WT,S=n.forwardRef((e,t)=>{let{className:r,children:s,...n}=e;return(0,a.jsxs)(b.l9,{ref:t,className:o("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...n,children:[s,(0,a.jsx)(b.In,{asChild:!0,children:(0,a.jsx)(y.A,{className:"h-4 w-4 opacity-50"})})]})});S.displayName=b.l9.displayName;let k=n.forwardRef((e,t)=>{let{className:r,children:s,position:n="popper",...i}=e;return(0,a.jsx)(b.ZL,{children:(0,a.jsx)(b.UC,{ref:t,className:o("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:n,...i,children:(0,a.jsx)(b.LM,{className:o("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s})})})});k.displayName=b.UC.displayName;let C=n.forwardRef((e,t)=>{let{className:r,children:s,...n}=e;return(0,a.jsxs)(b.q7,{ref:t,className:o("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(b.VF,{children:(0,a.jsx)(N.A,{className:"h-4 w-4"})})}),(0,a.jsx)(b.p4,{children:s})]})});C.displayName=b.q7.displayName,n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(b.JU,{ref:t,className:o("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...s})}).displayName=b.JU.displayName,n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(b.wv,{ref:t,className:o("-mx-1 my-1 h-px bg-muted",r),...s})}).displayName=b.wv.displayName;let E=n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("textarea",{className:o("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...s})});E.displayName="Textarea";var R=r(3628);let I=n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(R.bL,{ref:t,className:o("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...s,children:(0,a.jsx)(R.C1,{className:o("flex items-center justify-center text-current"),children:(0,a.jsx)(N.A,{className:"h-4 w-4"})})})});I.displayName=R.bL.displayName;var q=r(4352);let T=n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(q.b,{ref:t,className:o("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",r),...s})});T.displayName=q.b.displayName;let D=s.BACKEND,O=D.includes("localhost")?"ws":"wss";var P=function(e){return e.Idle="Inactivo",e.Listening="Escuchando",e.Speaking="Hablando",e.Interrupted="Interrumpido",e}(P||{});function W(){let e,t;let[r,o]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),[f,x]=(0,n.useState)(!1),[b,y]=(0,n.useState)(null),[N,R]=(0,n.useState)(""),[q,P]=(0,n.useState)(""),[W,A]=(0,n.useState)(""),[_,M]=(0,n.useState)(""),[U,L]=(0,n.useState)("Inactivo"),V=(0,n.useRef)("Inactivo");(0,n.useEffect)(()=>{V.current=U},[U]);let z=e=>{console.log("[GeminiState] ".concat(V.current," -> ").concat(e)),L(e)},[F,J]=(0,n.useState)({systemPrompt:s.SYSTEMPROMPT,googleSearch:!1,allowInterruptions:!0,tools:[{function_declarations:[{name:"write_text",description:"When you want to place some text in the UI explicitly. Use Line Breaks where appropriate to make it more readable.",parameters:{type:"object",properties:{text:{type:"string"}},required:["text"]}}]}]}),B=(0,n.useRef)(null),G=(0,n.useRef)((e=new Date().getTime(),t="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0,"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){let a=16*Math.random();return e>0?(a=(e+a)%16|0,e=Math.floor(e/16)):(a=(t+a)%16|0,t=Math.floor(t/16)),("x"===r?a:3&a|8).toString(16)}))),H=(0,n.useRef)(!1);(0,n.useEffect)(()=>{H.current=f},[f]);let[K,Y]=(0,n.useState)([]),[X,Z]=(0,n.useState)(null),[Q,$]=(0,n.useState)(!1),[ee,et]=(0,n.useState)(!0),er=(0,n.useRef)(null),ea=(0,n.useRef)(null),es=(0,n.useRef)(null),en=(0,n.useRef)(null);(0,n.useEffect)(()=>{et(!0);let e=async()=>{try{let e=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind).filter(e=>""!==e.deviceId).map(e=>({deviceId:e.deviceId,label:e.label||"Unnamed Camera"}));Y(e),e.length>0&&Z(e[0].deviceId)}catch(e){console.error("[enumerateDevices] Error:",e),y("[enumerateDevices] "+e.message)}};return(async()=>{try{await navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{e.getTracks().forEach(e=>e.stop())}).catch(e=>(console.warn("[Permissions] Video permission denied:",e),navigator.mediaDevices.getUserMedia({audio:!0}))).then(e=>{e&&e.getTracks().forEach(e=>e.stop())}).catch(e=>{console.error("[Permissions] Audio permission denied:",e),y("Please grant microphone permissions to use the voice chat.")})}catch(e){console.error("[Permissions] Error:",e),y("Media permissions are required: "+e.message)}})().then(e).finally(()=>{et(!1)}),navigator.mediaDevices.addEventListener("devicechange",e),()=>{navigator.mediaDevices.removeEventListener("devicechange",e)}},[]);let ei=async()=>{try{if(m(!0),B.current&&(B.current.readyState===WebSocket.OPEN||B.current.readyState===WebSocket.CONNECTING)){console.warn("[startCall] WebSocket already open/connecting");return}B.current=new WebSocket("".concat(O,"://").concat(D,"/ws/").concat(G.current)),B.current.onopen=async()=>{var e;console.log("[WS:onopen] Sending initial config to server..."),null===(e=B.current)||void 0===e||e.send(JSON.stringify({type:"config",config:F})),R(""),o(!0),x(!0)},B.current.onmessage=e=>{eo(e)},B.current.onerror=e=>{console.error("[WS:onerror]",e),y("[WebSocket:onerror] Unknown error occurred.")},B.current.onclose=e=>{console.warn("[WS:onclose]",e.code,e.reason),el()}}catch(e){console.error("[startCall] Error:",e),y("[startCall] "+e.message)}finally{m(!1)}},el=()=>{if(eu(),B.current)try{B.current.readyState===WebSocket.OPEN&&B.current.close()}catch(e){console.error("[stopCall] Error closing WebSocket:",e)}finally{B.current=null}R(""),P(""),A(""),M(""),y(null),o(!1),x(!1),L("Inactivo")},eo=async e=>{try{let s;if(e.data instanceof Blob){let t=await e.data.text();s=JSON.parse(t)}else s=JSON.parse(e.data);switch(s.type){case"gemini_ready":x(!0),z("Escuchando");break;case"audio":break;case"text":M(e=>e+s.data);break;case"tool_text":R(""+s.data);break;case"end_call":R("ENDING CALL: "+s.data),setTimeout(()=>{el()},5e3);break;case"turn_complete":z("Escuchando");break;case"cargar_ticket":R("Cargar Ticket: "+s.data);break;case"serverContent":var t,r,a;if(s.serverContent.interrupted){ec();return}(null===(a=s.serverContent.modelTurn)||void 0===a?void 0:null===(r=a.parts)||void 0===r?void 0:null===(t=r[0])||void 0===t?void 0:t.inlineData)&&s.serverContent.modelTurn.parts[0].inlineData.data,s.serverContent.turnComplete&&z("Escuchando");break;default:console.log("[WS:onmessage] Unhandled type:",s.type)}}catch(e){console.error("[onmessage] parse error:",e)}},ec=()=>{console.warn("[handleInterruption] Barge-in detected"),z("Interrumpido")};(0,n.useEffect)(()=>{if(!r){eu();return}Q?ed():eu()},[Q]),(0,n.useEffect)(()=>{r&&Q&&(eu(),ed())},[X]);let ed=async()=>{try{if(eu(),!B.current||B.current.readyState!==WebSocket.OPEN){console.warn("[startVideoStream] WS not open yet");return}let e={video:{width:{ideal:320},height:{ideal:240}}};X&&(e.video.deviceId={exact:X});let t=await navigator.mediaDevices.getUserMedia(e);er.current&&(er.current.srcObject=t),es.current=t,en.current=setInterval(()=>{em()},1e3)}catch(e){console.error("[startVideoStream] error:",e),y("[startVideoStream] "+e.message),$(!1)}},eu=()=>{if(es.current){try{es.current.getTracks().forEach(e=>{e.stop(),e.enabled=!1})}catch(e){console.error("[stopVideoStream] Error stopping tracks:",e)}es.current=null}if(en.current&&(clearInterval(en.current),en.current=null),er.current)try{er.current.srcObject=null,er.current.load()}catch(e){console.error("[stopVideoStream] Error cleaning up video element:",e)}},em=()=>{if(!H.current||!B.current||B.current.readyState!==WebSocket.OPEN||!ea.current||!er.current)return;let e=ea.current.getContext("2d");if(!e)return;ea.current.width=er.current.videoWidth,ea.current.height=er.current.videoHeight,e.drawImage(er.current,0,0);let t=ea.current.toDataURL("image/jpeg",.8).split(",")[1];B.current.send(JSON.stringify({type:"image",data:t}))};return(0,n.useEffect)(()=>()=>{el()},[]),(0,a.jsxs)("div",{className:"container mx-auto py-8 px-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("img",{src:"logo.png",alt:"Telecentro Logo",className:"h-10"}),(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Field Service"})]}),r?(0,a.jsxs)(p,{onClick:el,variant:"destructive",size:"lg",className:"px-6 py-4 text-xl font-semibold",children:[(0,a.jsx)(l.A,{className:"mr-2 h-5 w-5"}),"Stop Call"]}):ee?(0,a.jsx)("div",{className:"text-gray-500 animate-pulse",children:"Detecting Media..."}):(0,a.jsxs)(p,{onClick:ei,variant:"blue",size:"lg",className:"px-6 py-4 text-xl font-semibold",disabled:u||!1,children:[(0,a.jsx)(i.A,{className:"mr-2 h-5 w-5 ".concat(u?"animate-pulse":"")}),u?"Connecting...":"Start Call"]})]}),(0,a.jsx)("p",{className:"mt-2 mb-4",children:"Este chat de voz en tiempo real usa Gemini!"}),b&&(0,a.jsxs)(h,{variant:"destructive",children:[(0,a.jsx)(g,{children:"Error"}),(0,a.jsx)(v,{children:b})]}),r&&(0,a.jsx)(c,{children:(0,a.jsxs)(d,{className:"flex flex-col items-center justify-center pt-6 mt-2 space-y-4",children:[(0,a.jsx)(i.A,{className:"h-8 w-8 text-blue-500 animate-pulse"}),(0,a.jsx)("p",{className:"text-gray-600",children:f?"Call Ongoing...":"Waiting..."}),(0,a.jsxs)("div",{className:"mb-4",children:["Escuchando"===U&&(0,a.jsx)("div",{className:"text-green-600 font-semibold",children:"Gemini is listening..."}),"Hablando"===U&&(0,a.jsx)("div",{className:"text-blue-600 font-semibold",children:"Gemini is speaking..."}),"Interrumpido"===U&&(0,a.jsx)("div",{className:"text-red-500 font-semibold",children:"Gemini was interrupted (barge-in)!"})]}),(0,a.jsxs)("div",{className:"w-full px-4",children:[(0,a.jsx)(T,{htmlFor:"user-text-input",className:"text-left w-full block mb-2",children:"O escribe tu mensaje:"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(E,{id:"user-text-input",placeholder:"Escribe aqu\xed...",value:q,onChange:e=>P(e.target.value),className:"flex-grow"}),(0,a.jsx)(p,{onClick:()=>{B.current&&B.current.readyState===WebSocket.OPEN&&q.trim()&&(console.log('[sendText] Sending: "'.concat(q,'"')),B.current.send(JSON.stringify({type:"text",data:q})),A("".concat(W,"  User: ").concat(q)),P(""))},disabled:!q.trim(),children:"Enviar"})]})]})]})}),r&&Q&&(0,a.jsx)(c,{children:(0,a.jsx)(d,{className:"pt-4 space-y-4",children:(0,a.jsxs)("div",{className:"relative aspect-video bg-black rounded-lg overflow-hidden",children:[(0,a.jsx)("video",{ref:er,autoPlay:!0,playsInline:!0,muted:!0,width:320,height:240,className:"w-full h-full object-contain",style:{transform:(()=>{if(!X)return!1;let e=K.find(e=>e.deviceId===X);return!!e&&/front/i.test(e.label)})()?"scaleX(-1)":"none"}}),(0,a.jsx)("canvas",{ref:ea,className:"hidden",width:640,height:480})]})})}),N&&(0,a.jsx)(c,{className:"mt-4",children:(0,a.jsxs)(d,{className:"pt-4",children:[(0,a.jsx)("h2",{className:"font-semibold mb-2",children:"Tool Output"}),(0,a.jsx)("pre",{className:"whitespace-pre-wrap",children:N})]})}),_&&(0,a.jsx)(c,{className:"mt-4",children:(0,a.jsxs)(d,{className:"pt-4",children:[(0,a.jsx)("h2",{className:"font-semibold mb-2",children:"Respuesta del Asistente"}),(0,a.jsx)("pre",{className:"whitespace-pre-wrap text-gray-800 bg-gray-50 p-3 rounded-md",children:_})]})}),W&&(0,a.jsx)(c,{className:"mt-4",children:(0,a.jsxs)(d,{className:"pt-4",children:[(0,a.jsx)("h2",{className:"font-semibold mb-2",children:"Conversation"}),(0,a.jsx)("pre",{className:"whitespace-pre-wrap text-gray-700",children:W})]})}),(0,a.jsx)(c,{className:"mt-6",children:(0,a.jsxs)(d,{className:"pt-6 space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Seleccion de Media"}),ee?(0,a.jsx)("div",{className:"text-gray-500 animate-pulse",children:"Detectando Media..."}):(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(T,{htmlFor:"camera-select",children:"Camara"}),(0,a.jsxs)(j,{value:X||"",onValueChange:e=>Z(e),disabled:!K.length,children:[(0,a.jsx)(S,{id:"camera-select",children:(0,a.jsx)(w,{placeholder:"Select camera"})}),(0,a.jsx)(k,{children:K.map(e=>(0,a.jsx)(C,{value:e.deviceId,children:e.label||e.deviceId},e.deviceId))})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(I,{id:"enable-video",checked:Q,onCheckedChange:e=>$(!!e),disabled:!r}),(0,a.jsx)(T,{htmlFor:"enable-video",children:"Habilitar Video"})]})]})})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[719,441,517,358],()=>t(6951)),_N_E=e.O()}]);